pipeline {
agent any
tools{
    dockerTool 'docker'
}
parameters{
    string(name:'imagen_name',defaultValue:'flask_imagen', description:'nombre de la imagne')
    string(name:'conteiner_name',defaultValue:'flask_conteiner', description:'nombre del contenedor')
    string(name:'tag_image',defaultValue:'1', description:'numero de la inversion')
    string(name:'puerto',defaultValue:'8083', description:'puerto')
}
stages{
    stage('install'){
        steps{
            git branch: 'master', url: 'https://github.com/acruiz86/1raTarea.git/'

        }
    }
     stage('build'){
        steps{
            dir('.'){
                echo 'building....'
                script{
                    try{
                        sh 'docker -v'
                        sh 'docker stop ${conteiner_name}'
                        sh 'docker rm ${conteiner_name}'
                        sh 'docker rmi ${imagen_name}: ${tag_image}'
                    }
                    catch(Exception e)
                    {
                        echo 'Exception  prueba n   ocurred'+e.toString()
                    }
                }
                dir('.'){
                    script{
                        sh 'docker build -t ${imagen_name}:${tag_image} .'
                    }
                }
              

            }
            
        }
    }
}
}


